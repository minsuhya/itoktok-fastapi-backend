import{l as ne,u as re,i as de,z as b,c as ie,a as p,R as ue,U as G,S as ce,G as me,O as _e,x as g,H as pe,o as i,e as a,q as n,g as o,L as u,d as c,f as y,v as he,F as L,B as T,t as w,W as $,M as h,V as v,N as fe,j as V,a4 as be}from"./index-DYkgv6yf.js";import{s as ge}from"./client-CpW2S647.js";import{r as ye}from"./program-Bx7V3hkl.js";import{r as xe,c as we,e as ve,f as Ve}from"./schedule-B0kk96-p.js";import{M as ke}from"./MobileLayout-B5niWt1I.js";import{r as Se}from"./MagnifyingGlassIcon-C7p8OoOD.js";import"./teacherStore-Bd5PY4Ed.js";const Ue={class:"p-4"},De={class:"bg-white rounded-lg shadow-sm p-4"},Ie=a("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"일정 유형",-1),Me={class:"flex gap-4"},Le={class:"inline-flex items-center"},Te=a("span",{class:"ml-2"},"재활",-1),$e={class:"inline-flex items-center"},Ce=a("span",{class:"ml-2"},"상담/평가",-1),He={key:0,class:"bg-white rounded-lg shadow-sm p-4"},Fe=a("label",{for:"client-search",class:"block text-sm font-medium text-gray-700 mb-2"},"내담자",-1),qe={class:"relative"},Ne={class:"absolute inset-y-0 right-0 flex items-center pr-3"},Be={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},Ee=["onClick"],Oe={class:"bg-white rounded-lg shadow-sm p-4"},Ye=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 상담사 "),a("span",{class:"text-red-500"},"*")],-1),Re=a("option",{value:""},"상담사를 선택하세요.",-1),je=["value"],ze={key:1,class:"bg-white rounded-lg shadow-sm p-4"},Ae={class:"space-y-4"},Pe=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 내담자 이름 "),a("span",{class:"text-red-500"},"*")],-1),We=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 내담자 휴대전화번호 "),a("span",{class:"text-red-500"},"*")],-1),Ge={key:2},Je={class:"bg-white rounded-lg shadow-sm p-4"},Ke=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 프로그램 "),a("span",{class:"text-red-500"},"*")],-1),Qe=a("option",{value:""},"프로그램을 선택하세요",-1),Xe=["value"],Ze={class:"bg-white rounded-lg shadow-sm p-4"},et=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"일정 반복 타입",-1),tt=a("option",{value:"1"},"매일",-1),st=a("option",{value:"2"},"매주",-1),at=a("option",{value:"3"},"매월",-1),lt={key:3,class:"bg-white rounded-lg shadow-sm p-4"},ot=a("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"반복 요일",-1),nt={class:"grid grid-cols-4 gap-3"},rt={class:"inline-flex items-center"},dt=a("span",{class:"ml-2"},"월",-1),it={class:"inline-flex items-center"},ut=a("span",{class:"ml-2"},"화",-1),ct={class:"inline-flex items-center"},mt=a("span",{class:"ml-2"},"수",-1),_t={class:"inline-flex items-center"},pt=a("span",{class:"ml-2"},"목",-1),ht={class:"inline-flex items-center"},ft=a("span",{class:"ml-2"},"금",-1),bt={class:"inline-flex items-center"},gt=a("span",{class:"ml-2"},"토",-1),yt={class:"inline-flex items-center"},xt=a("span",{class:"ml-2"},"일",-1),wt={class:"bg-white rounded-lg shadow-sm p-4"},vt=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 일정시작일 "),a("span",{class:"text-red-500"},"*")],-1),Vt={class:"bg-white rounded-lg shadow-sm p-4"},kt={class:"grid grid-cols-2 gap-4"},St=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 시작시간 "),a("span",{class:"text-red-500"},"*")],-1),Ut=["value"],Dt=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[V(" 종료시간 "),a("span",{class:"text-red-500"},"*")],-1),It=["value"],Mt={class:"bg-white rounded-lg shadow-sm p-4"},Lt=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"메모",-1),Tt={class:"text-right text-gray-500 text-sm mt-1"},$t={class:"bg-white rounded-lg shadow-sm p-4"},Ct=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"상태",-1),Ht=a("option",{value:"1"},"예정",-1),Ft=a("option",{value:"2"},"완료",-1),qt=a("option",{value:"3"},"취소",-1),Nt={key:4,class:"bg-white rounded-lg shadow-sm p-4"},Bt=a("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"일정 수정 범위",-1),Et={class:"space-y-2"},Ot={class:"inline-flex items-center"},Yt=a("span",{class:"ml-2"},"이번 일정만 변경",-1),Rt={class:"inline-flex items-center"},jt=a("span",{class:"ml-2"},"이후 반복일정 모두 변경",-1),zt={class:"flex gap-3 pb-4"},At={type:"submit",class:"flex-1 bg-blue-600 text-white rounded-md py-3 font-semibold"},Zt={__name:"ScheduleFormView",props:{scheduleId:String,scheduleListId:String,scheduleDate:{type:String,default:()=>{const k=new Date;return`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}-${String(k.getDate()).padStart(2,"0")}`}},scheduleTime:{type:String,default:()=>`${new Date().getHours().toString().padStart(2,"0")}:00`}},setup(k){const F=ne(),E=re(),S=de("showModal",()=>{}),r=k,C=b(""),O=b([]),D=b([]),J=b({}),Y=b([]),R=b([]),I=new Date,K=async()=>{const l=C.value.toLowerCase();if(!l){D.value=[];return}try{const t=await ge(l);O.value=t.data,D.value=O.value}catch(t){console.error("Error fetching clients:",t)}},Q=async l=>{if(J.value=l,C.value=l.client_name,e.client_id=l.id,e.client_name=l.client_name,e.phone_number=l.phone_number,D.value=[],l.consultant)try{const t=await be(l.consultant);e.teacher_username=t.username,await B()}catch(t){console.error("Error fetching consultant info:",t)}},j=b([]),z=b([]),X=()=>{const l=[];let t=new Date(I);for(t.setHours(9,0,0,0);t.getHours()<18;)l.push(q(t)),t.setMinutes(t.getMinutes()+10);return l},q=l=>{const t=l.getHours().toString().padStart(2,"0"),s=l.getMinutes().toString().padStart(2,"0");return`${t}:${s}`};function x(l){if(!l){const _=new Date,f=_.getHours().toString().padStart(2,"0"),H=_.getMinutes();let U;return H>=40?U="40":H>=20?U="20":U="00",`${f}:${U}`}const t=String(l);if(!t.includes(":")){const _=parseInt(t);return _<10?`0${_}:00`:`${t}:00`}const[s,d]=t.split(":"),m=parseInt(s);return m<10?`0${m}:${d}`:`${s}:${d}`}const M=(l=!1)=>{if(!e.start_time)return;const[t,s]=e.start_time.split(":").map(Number),d=new Date(I);d.setHours(t,s,0,0);const m=[],_=new Date(d);_.setHours(d.getHours()+1);let f=new Date(d);for(f.setMinutes(f.getMinutes()+10);f<=_;)m.push(q(f)),f.setMinutes(f.getMinutes()+10);if(z.value=m,!l&&!e.finish_time){const[H,U]=e.start_time.split(":").map(Number),W=new Date;W.setHours(H,U+50),e.finish_time=q(W)}},Z=ie({teacher_username:p().required("상담사를 선택해주세요."),client_name:p().required("내담자를 선택해주세요."),phone_number:p().required("휴대전화번호를 입력하세요."),program_id:p().when("teacher_username",{is:l=>l&&l.length>0,then:()=>p().required("프로그램을 선택해주세요."),otherwise:()=>p()}),start_date:p().required("일정시작일을 선택해주세요."),finish_date:p().transform((l,t,s)=>{var m;const d=(m=s==null?void 0:s.parent)==null?void 0:m.start_date;if(d){const _=new Date(d);return _.setFullYear(_.getFullYear()+1),_.toISOString().split("T")[0]}return l}),start_time:p().required("시작시간을 선택해주세요."),finish_time:p().required("종료시간을 선택해주세요."),repeat_type:p().required("반복 타입을 선택해주세요.")}),e=ue({id:"",teacher_username:"",client_id:"",schedule_type:1,client_name:"",program_id:"",repeat_type:2,repeat_days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},schedule_status:1,start_date:r.scheduleDate,finish_date:r.scheduleDate,start_time:x(r.scheduleTime),finish_time:x(r.scheduleTime),memo:"",update_range:"single"}),N=l=>{const t=["sun","mon","tue","wed","thu","fri","sat"],s=new Date(l),d=t[s.getDay()];return{mon:d==="mon",tue:d==="tue",wed:d==="wed",thu:d==="thu",fri:d==="fri",sat:d==="sat",sun:d==="sun"}},ee=l=>{const t={mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1};if(!l)return t;if(typeof l=="object"&&!Array.isArray(l))return l;if(typeof l=="string")try{return JSON.parse(l.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false"))}catch{return t}return t},A=()=>{e.id="",e.teacher_username="",e.client_id="",e.schedule_type=1,e.client_name="",e.program_id="",e.repeat_type=2,e.repeat_days=N(r.scheduleDate),e.schedule_status=1,e.start_date=r.scheduleDate,e.finish_date=r.scheduleDate,e.start_time=r.scheduleTime?x(r.scheduleTime):x(I.getHours()),e.finish_time="",e.memo="",e.update_range="single"},te=async()=>{if(!r.scheduleListId){A(),e.repeat_days=N(r.scheduleDate),M();return}try{const l=await xe(r.scheduleListId),{clientinfo:t,teacher:s,schedule:d,...m}=l;Object.assign(e,m,d),e.memo=m.schedule_memo||"",e.schedule_type=d.schedule_type||1,e.client_name=(t==null?void 0:t.client_name)||"",e.phone_number=(t==null?void 0:t.phone_number)||"",e.teacher_username=(s==null?void 0:s.username)||"",e.start_time=m.schedule_time||x(I.getHours()),e.finish_time=m.schedule_finish_time||"",e.teacher_username&&await B(),M(!0),e.repeat_days=ee(e.repeat_days)}catch(l){console.error("Error fetching schedule info:",l),S("일정 정보를 불러오는 중 오류가 발생했습니다.")}},se=async()=>{try{const l=await pe();Y.value=l.map(t=>({value:t.username,text:t.full_name}))}catch(l){console.error("Error fetching teacher list:",l)}},B=async()=>{try{const l=await ye(1,100,"",e.teacher_username);R.value=l.items.map(t=>({value:t.id,text:t.program_name}))}catch(l){console.error("프로그램 목록 조회 중 오류:",l)}},P=()=>{F.back()},ae=()=>{document.querySelector("form").requestSubmit()},le=async l=>{try{const t={...l,repeat_days:e.repeat_days,finish_date:new Date(new Date(l.start_date).setFullYear(new Date(l.start_date).getFullYear()+1)).toISOString().split("T")[0],update_range:e.update_range};if(delete t.created_at,delete t.updated_at,delete t.deleted_at,e.id){const s=e.update_range==="all"?"이 일정과 향후 모든 반복 일정이 수정됩니다. 계속하시겠습니까?":"이 일정만 수정됩니다. 계속하시겠습니까?";if(!confirm(s))return;await we(e.id,r.scheduleListId,t),S("상담일정 정보가 수정되었습니다.")}else await ve(t),S("상담일정 정보가 등록되었습니다.");A(),F.back()}catch(t){S("상담일정 정보 저장 중 오류가 발생했습니다."),console.error("Error registering schedule data:",t)}},oe=async()=>{try{if(!r.scheduleListId)return;const l=e.update_range==="all"?"이 일정과 향후 모든 반복 일정이 삭제됩니다. 계속하시겠습니까?":"이 일정만 삭제됩니다. 계속하시겠습니까?";if(!confirm(l))return;await Ve(e.id,r.scheduleListId,e.update_range),S("일정이 삭제되었습니다."),F.back()}catch(l){console.error("Error deleting schedule:",l),S("일정 삭제 중 오류가 발생했습니다.")}};return G(()=>r.scheduleDate,l=>{l&&(e.start_date=l,e.finish_date=l,!r.scheduleListId&&l&&(e.repeat_days=N(l)))}),G(()=>r.scheduleTime,l=>{l&&(e.start_time=x(l),M())}),ce(()=>{te(),se()}),me(()=>{j.value=X(),e.start_time||(e.start_time=x(I.getHours())),e.start_time>="18:00"&&(e.start_time="17:50"),M()}),(l,t)=>(i(),_e(ke,{"header-title":"일정 등록","show-back":!0,"show-save":!0,"active-tab":"calendar",onBack:P,onSave:ae},{default:g(()=>[a("div",Ue,[n(o(fe),{onSubmit:le,"validation-schema":o(Z),"initial-values":e,class:"space-y-4"},{default:g(()=>[n(o(u),{type:"hidden",name:"id",modelValue:e.id,"onUpdate:modelValue":t[0]||(t[0]=s=>e.id=s)},null,8,["modelValue"]),n(o(u),{type:"hidden",name:"client_id",modelValue:e.client_id,"onUpdate:modelValue":t[1]||(t[1]=s=>e.client_id=s)},null,8,["modelValue"]),a("div",De,[Ie,a("div",Me,[a("label",Le,[n(o(u),{type:"radio",name:"schedule_type",value:1,modelValue:e.schedule_type,"onUpdate:modelValue":t[2]||(t[2]=s=>e.schedule_type=s),class:"form-radio text-blue-600"},null,8,["modelValue"]),Te]),a("label",$e,[n(o(u),{type:"radio",name:"schedule_type",value:2,modelValue:e.schedule_type,"onUpdate:modelValue":t[3]||(t[3]=s=>e.schedule_type=s),class:"form-radio text-blue-600"},null,8,["modelValue"]),Ce])])]),!r.scheduleId&&!r.scheduleListId?(i(),c("div",He,[Fe,a("div",qe,[y(a("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.value=s),onInput:K,type:"text",id:"client-search",placeholder:"내담자 검색...",class:"block w-full py-2 pr-10 pl-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,544),[[he,C.value]]),a("div",Ne,[n(o(Se),{class:"h-5 w-5 text-gray-400"})]),D.value.length>0?(i(),c("ul",Be,[(i(!0),c(L,null,T(D.value,s=>(i(),c("li",{key:s.id,onClick:d=>Q(s),class:"cursor-pointer px-3 py-2 hover:bg-blue-600 hover:text-white"},w(s.client_name),9,Ee))),128))])):$("",!0)])])):$("",!0),a("div",Oe,[Ye,n(o(u),{name:"teacher_username",modelValue:e.teacher_username,"onUpdate:modelValue":t[5]||(t[5]=s=>e.teacher_username=s),as:"select",class:"w-full bg-white border border-gray-300 rounded-md p-2",onChange:B},{default:g(()=>[Re,(i(!0),c(L,null,T(Y.value,s=>(i(),c("option",{key:s.value,value:s.value},w(s.text),9,je))),128))]),_:1},8,["modelValue"]),n(o(h),{name:"teacher_username",class:"text-red-500 text-xs italic mt-1"})]),o(E).user.user_type==1&&o(E).user.is_superuser==1?(i(),c("div",ze,[a("div",Ae,[a("div",null,[Pe,n(o(u),{name:"client_name",as:"input",type:"text",modelValue:e.client_name,"onUpdate:modelValue":t[6]||(t[6]=s=>e.client_name=s),class:"w-full bg-white border border-gray-300 rounded-md p-2",placeholder:"내담자 이름을 입력하세요."},null,8,["modelValue"]),n(o(h),{name:"client_name",class:"text-red-500 text-xs italic mt-1"})]),a("div",null,[We,n(o(u),{name:"phone_number",as:"input",type:"text",modelValue:e.phone_number,"onUpdate:modelValue":t[7]||(t[7]=s=>e.phone_number=s),class:"w-full bg-white border border-gray-300 rounded-md p-2",placeholder:"내담자 휴대전화번호를 입력하세요."},null,8,["modelValue"]),n(o(h),{name:"phone_number",class:"text-red-500 text-xs italic mt-1"})])])])):(i(),c("div",Ge,[n(o(u),{name:"client_name",type:"hidden",modelValue:e.client_name,"onUpdate:modelValue":t[8]||(t[8]=s=>e.client_name=s)},null,8,["modelValue"]),n(o(u),{name:"phone_number",type:"hidden",modelValue:e.phone_number,"onUpdate:modelValue":t[9]||(t[9]=s=>e.phone_number=s)},null,8,["modelValue"])])),a("div",Je,[Ke,n(o(u),{name:"program_id",modelValue:e.program_id,"onUpdate:modelValue":t[10]||(t[10]=s=>e.program_id=s),as:"select",class:"w-full bg-white border border-gray-300 rounded-md p-2"},{default:g(()=>[Qe,(i(!0),c(L,null,T(R.value,s=>(i(),c("option",{key:s.value,value:s.value},w(s.text),9,Xe))),128))]),_:1},8,["modelValue"]),n(o(h),{name:"program_id",class:"text-red-500 text-xs italic mt-1"})]),a("div",Ze,[et,n(o(u),{name:"repeat_type",modelValue:e.repeat_type,"onUpdate:modelValue":t[11]||(t[11]=s=>e.repeat_type=s),as:"select",class:"w-full bg-white border border-gray-300 rounded-md p-2"},{default:g(()=>[tt,st,at]),_:1},8,["modelValue"]),n(o(h),{name:"repeat_type",class:"text-red-500 text-xs italic mt-1"})]),e.repeat_type=="2"?(i(),c("div",lt,[ot,a("div",nt,[a("label",rt,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=s=>e.repeat_days.mon=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.mon]]),dt]),a("label",it,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=s=>e.repeat_days.tue=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.tue]]),ut]),a("label",ct,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=s=>e.repeat_days.wed=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.wed]]),mt]),a("label",_t,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[15]||(t[15]=s=>e.repeat_days.thu=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.thu]]),pt]),a("label",ht,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=s=>e.repeat_days.fri=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.fri]]),ft]),a("label",bt,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=s=>e.repeat_days.sat=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.sat]]),gt]),a("label",yt,[y(a("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=s=>e.repeat_days.sun=s),class:"form-checkbox h-4 w-4 text-blue-600"},null,512),[[v,e.repeat_days.sun]]),xt])])])):$("",!0),a("div",wt,[vt,n(o(u),{type:"date",name:"start_date",modelValue:e.start_date,"onUpdate:modelValue":t[19]||(t[19]=s=>e.start_date=s),class:"w-full bg-white border border-gray-300 rounded-md p-2"},null,8,["modelValue"]),n(o(h),{name:"start_date",class:"text-red-500 text-xs italic mt-1"})]),a("div",Vt,[a("div",kt,[a("div",null,[St,n(o(u),{name:"start_time",modelValue:e.start_time,"onUpdate:modelValue":t[20]||(t[20]=s=>e.start_time=s),as:"select",onChange:M,class:"w-full bg-white border border-gray-300 rounded-md p-2"},{default:g(()=>[(i(!0),c(L,null,T(j.value,s=>(i(),c("option",{key:s,value:s},w(s),9,Ut))),128))]),_:1},8,["modelValue"]),n(o(h),{name:"start_time",class:"text-red-500 text-xs italic mt-1"})]),a("div",null,[Dt,n(o(u),{name:"finish_time",modelValue:e.finish_time,"onUpdate:modelValue":t[21]||(t[21]=s=>e.finish_time=s),as:"select",class:"w-full bg-white border border-gray-300 rounded-md p-2"},{default:g(()=>[(i(!0),c(L,null,T(z.value,s=>(i(),c("option",{key:s,value:s},w(s),9,It))),128))]),_:1},8,["modelValue"]),n(o(h),{name:"finish_time",class:"text-red-500 text-xs italic mt-1"})])])]),a("div",Mt,[Lt,n(o(u),{name:"memo",as:"textarea",class:"w-full bg-white border border-gray-300 rounded-md p-2",rows:"3",modelValue:e.memo,"onUpdate:modelValue":t[22]||(t[22]=s=>e.memo=s),placeholder:"내담자의 상담정보를 메모해보세요. 최대 100자 까지 입력하실 수 있습니다."},null,8,["modelValue"]),n(o(h),{name:"memo",class:"text-red-500 text-xs italic mt-1"}),a("div",Tt,w(e.memo.length)+" / 100",1)]),a("div",$t,[Ct,n(o(u),{name:"schedule_status",modelValue:e.schedule_status,"onUpdate:modelValue":t[23]||(t[23]=s=>e.schedule_status=s),as:"select",class:"w-full bg-white border border-gray-300 rounded-md p-2"},{default:g(()=>[Ht,Ft,qt]),_:1},8,["modelValue"])]),r.scheduleId&&r.scheduleListId?(i(),c("div",Nt,[Bt,a("div",Et,[a("label",Ot,[n(o(u),{type:"radio",name:"update_range",value:"single",modelValue:e.update_range,"onUpdate:modelValue":t[24]||(t[24]=s=>e.update_range=s),class:"form-radio"},null,8,["modelValue"]),Yt]),a("label",Rt,[n(o(u),{type:"radio",name:"update_range",value:"all",modelValue:e.update_range,"onUpdate:modelValue":t[25]||(t[25]=s=>e.update_range=s),class:"form-radio"},null,8,["modelValue"]),jt])])])):$("",!0),a("div",zt,[a("button",{type:"button",onClick:P,class:"flex-1 bg-gray-400 text-white rounded-md py-3 font-semibold"}," 취소 "),r.scheduleListId?(i(),c("button",{key:0,type:"button",onClick:oe,class:"flex-1 bg-red-600 text-white rounded-md py-3 font-semibold"}," 삭제 ")):$("",!0),a("button",At,w(r.scheduleListId?"수정":"등록"),1)])]),_:1},8,["validation-schema","initial-values"])])]),_:1}))}};export{Zt as default};
