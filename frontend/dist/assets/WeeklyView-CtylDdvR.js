import{R as xe,z as u,S as De,U as ee,r as ke,d as i,e as s,q as D,x as te,C as w,w as B,g as p,t as v,F as k,B as C,f as _e,V as ye,j as N,W as I,o as h,J as U}from"./index-DyikdeVs.js";import{_ as Se,a as Ce,r as $e,b as Me,d as Te}from"./DailyViewSliding-BGEfkLLW.js";import{u as Ve}from"./calendarStore-CtSzQqFQ.js";import{u as Fe}from"./teacherStore-BQywt_cN.js";import{a as Ye,b as Ee}from"./schedule-DRuf90Am.js";import"./client-BmLc_bHX.js";import"./program-BvKTe_J8.js";import"./MagnifyingGlassIcon-iw8J5XU6.js";const ze=s("section",null,[s("div",{class:"w-full sm:container"},[s("div",{class:"border-black border-l-[5px] pl-5"},[s("h2",{class:"text-dark mb-2 text-2xl font-semibold dark:text-white"},"주간 일정")])])],-1),He={class:"max-w-full mx-auto p-4"},je={class:"flex justify-between items-center"},We={class:"inline-flex rounded-lg border border-gray-200 bg-white p-1"},Be=s("span",{class:"text-sm font-medium"}," 주간 ",-1),Ne=s("span",{class:"text-sm font-medium"}," 월간 ",-1),Ie={class:"flex items-center space-x-2"},Oe={class:"text-xl font-semibold"},Ae={class:"flex space-x-2 text-sm font-semibold"},Le=s("span",null,"Today",-1),Ue=[Le],Re={class:"not-prose relative bg-slate-50 rounded-xl overflow-hidden w-full mx-auto dark:bg-slate-800/25"},qe={class:"relative rounded-xl overflow-auto"},Je={class:"mx-4 mt-4 box-content bg-white dark:bg-slate-800 shadow-xl overflow-hidden"},Pe={class:"grid grid-cols-[70px,repeat(7,1fr)] grid-rows-1 h-auto"},Ze=s("div",{class:"row-start-[1] col-start-[1] sticky top-0 bg-white dark:bg-gradient-to-b dark:from-slate-600 dark:to-slate-700 border-slate-100 dark:border-black/10 bg-clip-padding text-slate-900 dark:text-slate-200 border-b text-sm font-medium py-2"},null,-1),Ge={class:"sm:inline-block rounded-full bg-slate-400 w-5 h-5 text-white font-semibold"},Ke={class:"mx-4 mb-4 box-content bg-white dark:bg-slate-800 shadow-xl overflow-y-auto max-h-[calc(100vh-200px)]"},Qe={class:"grid grid-cols-[70px,repeat(7,1fr)] grid-rows-1 max-h-full h-full"},Xe={class:"flex-row h-full"},et=s("div",{class:"w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[10px] border-l-red-500"},null,-1),tt=[et],st=["onClick","onDrop"],at=s("div",{class:"absolute left-0 w-full border-t border-slate-100 top-[30px]"},null,-1),lt=s("div",{class:"absolute left-0 w-full border-t border-slate-100 top-[60px]"},null,-1),ot=["onDragstart","onMouseover","onClick"],rt={class:"inline-block"},nt={class:"ml-auto inline-block whitespace-nowrap overflow-hidden text-ellipsis"},ct=s("span",{class:"inline-block"},"상담사",-1),dt={class:"ml-auto inline-block"},ut=s("span",{class:"inline-block"},"상담시간",-1),it={class:"ml-auto inline-block"},vt=["onClick"],ht=s("div",{class:"absolute inset-0 pointer-events-none border border-black/5 rounded-xl dark:border-white/5"},null,-1),gt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},bt={class:"bg-white p-6 rounded-lg w-96"},pt=s("h3",{class:"text-lg font-semibold mb-4"},"일정 이동",-1),ft={class:"mb-4"},mt={class:"mb-4"},wt={class:"flex items-center"},xt={class:"flex justify-end space-x-2"},Vt={__name:"WeeklyView",setup(Dt){const $=Ve(),se=Fe(),O=xe({}),M=u(!1),_=u(!1),T=u(""),V=u(""),g=u(""),m=u(""),A=u([]),n=u({}),x=new Date,R=u(!1),y=u(null),F=u(!1),Y=u(""),E=u(""),z=u(!1),L=u(null),ae=["Mon","Tue","Web","Thu","Fri","Sat","Sun"];function le(e){return e<10?`0${e}:00`:`${e}:00`}const H=e=>{const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${l}`},oe=e=>{const t=[];for(let a=0;a<7;a++){const l=new Date(e);l.setDate(e.getDate()+a);const r=l.getDay()-1;t.push({date:H(l),day:ae[r===-1?6:r]})}return t},j=()=>{M.value=!M.value,M.value||(T.value="",g.value="",m.value="",f(n.value.currentYear,n.value.currentMonth,n.value.currentDay))},q=()=>{_.value=!_.value,_.value||(g.value="",m.value="",f(n.value.currentYear,n.value.currentMonth,n.value.currentDay))},re=e=>{g.value=e,q()},ne=(e,t,a)=>{const l=a.target.getBoundingClientRect(),r=a.clientY-l.top,d=l.height;let c=0;r<d/3?c=0:r<d*2/3?c=20:c=40,T.value="",V.value="",g.value="",g.value=e,m.value=`${t}:${c.toString().padStart(2,"0")}`,j(),console.log("currentScheduleTime:",m.value)},J=(e,t,a)=>{T.value=String(e),V.value=String(t),g.value=a,j()},f=async(e,t,a)=>{e=e||new Date().getFullYear(),t=t||new Date().getMonth()+1,a=a||new Date().getDate(),console.log("year:",e,"month:",t,"day:",a);try{const l=await Ye(e,t,a);A.value=l.data,W(e,t-1,a),console.log("schedule_data:",A.value)}catch(l){console.error("Error fetching monthly schedule data:",l)}},ce=(e,t,a)=>{const l=new Date(e,t,a);console.log("date:",l);let r=l.getDay();r=r===0?6:r-1;const d=new Date(l);d.setDate(l.getDate()-r);const c=new Date(d);c.setDate(d.getDate()+6);const o=new Date(d);o.setDate(d.getDate()-1);const b=new Date(c);return b.setDate(c.getDate()+1),{currentYear:e,currentMonth:t+1,currentDay:a,weekStartDate:d,weekEndDate:c,prevStartDate:o,nextEndDate:b}},de=()=>{const e=n.value.prevStartDate.getFullYear(),t=n.value.prevStartDate.getMonth()+1,a=n.value.prevStartDate.getDate();W(e,t,a),f(e,t,a)},ue=()=>{const e=n.value.nextEndDate.getFullYear(),t=n.value.nextEndDate.getMonth()+1,a=n.value.nextEndDate.getDate();W(e,t,a),f(e,t,a)},W=(e,t,a)=>{n.value=ce(e,t,a),n.value.weekDates=oe(n.value.weekStartDate),console.log("set Date Info - currentDateInfo:",n.value)},ie=(e,t)=>{const a=new Date(`2000-01-01 ${e}`),r=(new Date(`2000-01-01 ${t}`)-a)/(1e3*60);return r>=50?80:r/50*80},ve=e=>{const[t,a]=e.split(":").map(Number);return a/60*90},he=(e,t)=>{R.value=!0,y.value=e,t.dataTransfer.effectAllowed="move",t.target.style.zIndex="9999"},ge=e=>{R.value=!1,e.target.style.zIndex=""},be=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},pe=(e,t,a)=>{a.preventDefault(),y.value&&(Y.value=e,E.value=t,F.value=!0)},fe=async()=>{try{(await Ee({scheduleId:y.value.schedule_id,scheduleListId:y.value.id,newDate:Y.value,newTime:E.value,updateAllFuture:z.value})).success&&(_.value&&V.value===y.value.id&&(g.value=Y.value,m.value=`${E.value}:00`),await f(n.value.currentYear,n.value.currentMonth,n.value.currentDay),F.value=!1,z.value=!1)}catch(e){console.error("Error updating schedule:",e)}},me=e=>{L.value=e},we=()=>{L.value=null};return De(()=>{g.value=H(new Date),m.value=le(new Date().getHours());const e=new Date().getFullYear(),t=new Date().getMonth()+1,a=new Date().getDate();W(e,t,a),f(e,t,a)}),ee(()=>$.selectedDate,e=>{e&&f(e.getFullYear(),e.getMonth()+1,e.getDate())}),ee(()=>se.selectedTeachers,e=>{e&&f($.selectedDate.getFullYear(),$.selectedDate.getMonth()+1,$.selectedDate.getDate())}),(e,t)=>{const a=ke("router-link");return h(),i(k,null,[ze,s("div",He,[s("div",je,[s("div",We,[D(a,{to:"/admin/weekly",class:w(["inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm text-gray-700 hover:text-gray-900",{"bg-blue-500 text-white":e.$route.path==="/admin/weekly"}])},{default:te(()=>[Be]),_:1},8,["class"]),D(a,{to:"/admin/monthly",class:w(["inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm text-gray-700 hover:text-gray-900",{"bg-blue-500 text-white":e.$route.path==="/admin/monthly"}])},{default:te(()=>[Ne]),_:1},8,["class"])]),s("div",Ie,[s("button",{onClick:t[0]||(t[0]=B(l=>de(),["stop"])),class:"p-2 rounded-full font-semibold"},[D(p($e),{class:"w-6 h-6"})]),s("h2",Oe,v(H(n.value.weekStartDate))+" ~ "+v(H(n.value.weekEndDate)),1),s("button",{onClick:t[1]||(t[1]=B(l=>ue(),["stop"])),class:"p-2 rounded-full font-semibold"},[D(p(Me),{class:"w-6 h-6"})])]),s("div",Ae,[s("button",{onClick:t[2]||(t[2]=l=>f(p(x).getFullYear(),p(x).getMonth()+1,p(x).getDate())),class:"px-4 py-2 bg-white border border-gray-300 rounded-md flex items-center"},Ue),s("button",{onClick:j,class:"px-4 py-2 bg-blue-500 text-white rounded-md"}," 상담 등록 ")])])]),s("div",Re,[s("div",qe,[s("div",Je,[s("div",Pe,[Ze,(h(!0),i(k,null,C(n.value.weekDates,(l,r)=>(h(),i("div",{key:r,class:w(["row-start-[1] col-start-[{{ index + 2 }}] sticky top-0 dark:bg-gradient-to-b dark:from-slate-600 dark:to-slate-700 border-slate-100 dark:border-black/10 bg-clip-padding text-slate-900 dark:text-slate-200 border-b text-sm font-medium py-2 text-center",l.date===p(x).toISOString().split("T")[0]?"bg-yellow-100":"bg-white"])},[s("span",Ge,v(l.date.split("-")[2]),1),N(" "+v(l.day),1)],2))),128))])]),s("div",Ke,[s("div",Qe,[s("div",Xe,[(h(),i(k,null,C(11,l=>s("div",{key:l,class:"h-[90px] border-slate-100 dark:border-slate-200/5 border-r text-xs p-1.5 text-right text-slate-400 uppercase sticky left-0 bg-white dark:bg-slate-800 font-medium relative"},[p(x).getHours()>=l+7&&p(x).getHours()<l+8?(h(),i("div",{key:0,class:"absolute left-0",style:U({top:`${p(x).getMinutes()/60*90}px`})},tt,4)):I("",!0),N(" "+v(l+7>=12?`${(l+7)%12||12} PM`:`${l+7} AM`),1)])),64))]),(h(!0),i(k,null,C(A.value,(l,r)=>(h(),i("div",{key:r,class:"flex-row h-full items-center text-center border-slate-100 dark:border-slate-200/5 border-r divide-y divide-slate-100 dark:divide-slate-200"},[(h(!0),i(k,null,C(l,(d,c)=>(h(),i("div",{key:c,onClick:o=>ne(r,c,o),onDragover:be,onDrop:o=>pe(r,c,o),class:w(["h-[90px] text-xs text-slate-400 font-medium p-[1px] relative",r===new Date().toISOString().split("T")[0]?"bg-yellow-100":""])},[at,lt,r==new Intl.DateTimeFormat("fr-CA").format(new Date)&&c==Math.floor(new Date().getHours())?(h(),i("div",{key:0,class:"absolute left-0 w-full border-t border-red-500 border-dashed",style:U({top:`${new Date().getMinutes()/60*90}px`})},null,4)):I("",!0),(h(!0),i(k,null,C(d,(o,b)=>{var P,Z,G,K,Q,X;return h(),i("div",{class:w(["absolute flex-row text-xs text-black border border-gray-700 rounded-md m-1 space-y-1 w-full pt-1 border-blue-700",["transform transition duration-500 ease-in-out overflow-hidden absolute cursor-move",(Z=(P=O[r])==null?void 0:P[c])!=null&&Z[b]?"scale-105 w-full pt-1 border-blue-700":"scale-100"]]),key:b,draggable:"true",onDragstart:S=>he(o,S),onDragend:t[3]||(t[3]=S=>ge(S)),onMouseover:S=>me(o),onMouseout:we,style:U({backgroundColor:(K=(G=O[r])==null?void 0:G[c])!=null&&K[b]?"rgb(255, 255, 255)":`${o.teacher_usercolor}`,zIndex:L.value===o?20:(X=(Q=O[r])==null?void 0:Q[c])!=null&&X[b]?10:1,height:ie(o.schedule_time,o.schedule_finish_time)+"px",left:b===0?"0":`${b*(100/d.length)}%`,width:b===0?"98%":`${100/d.length}%`,top:ve(o.schedule_time)+"px",transition:"z-index 0s, transform 0.3s ease-in-out"}),onClick:B(S=>J(o.schedule_id,o.id,o.schedule_date),["stop"])},[s("div",{class:w(["flex justify-between items-center px-1 w-full",{"line-through":o.schedule_status==="3"}])},[s("span",rt,v(o.schedule_time),1),s("span",nt,"["+v(o.client_name)+"] "+v(o.program_name.length>10?o.program_name.slice(0,10)+"...":o.program_name),1)],2),s("div",{class:w(["flex justify-between items-center px-1 w-full min-w-20 overflow-hidden",{"line-through":o.schedule_status==="3"}])},[ct,s("span",dt,v(o.teacher_fullname),1)],2),s("div",{class:w(["flex justify-between items-center px-1 w-full min-w-20 overflow-hidden",{"line-through":o.schedule_status==="3"}])},[ut,s("span",it,v(o.schedule_time)+" ~ "+v(o.schedule_finish_time),1)],2)],46,ot)}),128)),d.length>3?(h(),i("div",{key:1,class:"flex items-center justify-center ml-auto w-6 h-5 text-xs text-black border border-blue-700/10 rounded-md m-1 bg-blue-400/20",onClick:B(o=>re(r),["stop"])},[D(p(Te),{class:"w-5 h-4"}),N(" "+v(d.length-2),1)],8,vt)):I("",!0)],42,st))),128))]))),128))])])]),ht,D(Se,{isVisible:M.value,scheduleId:T.value,scheduleListId:V.value,scheduleDate:g.value,scheduleTime:m.value,onClose:j,class:"z-20"},null,8,["isVisible","scheduleId","scheduleListId","scheduleDate","scheduleTime"]),D(Ce,{isDailyViewSlidingVisible:_.value,scheduleDate:g.value,scheduleTime:m.value,onClose:q,onClickCalendarSchedule:J,class:"z-10"},null,8,["isDailyViewSlidingVisible","scheduleDate","scheduleTime"])]),F.value?(h(),i("div",gt,[s("div",bt,[pt,s("p",ft,v(Y.value)+" "+v(E.value)+"시로 일정을 이동하시겠습니까? ",1),s("div",mt,[s("label",wt,[_e(s("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=l=>z.value=l),class:"mr-2"},null,512),[[ye,z.value]]),N(" 이후 모든 일정에 적용 ")])]),s("div",xt,[s("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[5]||(t[5]=l=>F.value=!1)}," 취소 "),s("button",{class:"px-4 py-2 bg-blue-500 text-white rounded",onClick:fe}," 확인 ")])])])):I("",!0)],64)}}};export{Vt as default};
