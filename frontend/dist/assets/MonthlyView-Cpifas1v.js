import{o as p,d as b,e as t,V as ae,y as u,z as ne,W as Z,r as re,q as m,x as J,O as f,g as y,t as d,F as T,A as U,f as ce,X as ie,j as W,H as q,B as ue,S as de,w as g}from"./index-DlAM29Ex.js";import{_ as he,a as ve,g as me,u as fe,r as ge,b as pe,c as be,d as xe,e as _e}from"./DailyViewSliding-BuvIlRdT.js";import{u as we,a as ke}from"./teacherStore-WQfgK_oR.js";import"./client-lYGYqiHx.js";import"./program-DgM9xBpT.js";function ye(H,D){return p(),b("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z","clip-rule":"evenodd"})])}const De=t("section",null,[t("div",{class:"w-full sm:container"},[t("div",{class:"border-black border-l-[5px] pl-5"},[t("h2",{class:"text-dark mb-2 text-2xl font-semibold dark:text-white"},"월간 일정")])])],-1),Ce={class:"max-w-full mx-auto p-4"},Me={class:"flex justify-between items-center mb-4"},Se={class:"inline-flex rounded-lg border border-gray-200 bg-white p-1"},$e=t("span",{class:"text-sm font-medium"}," 주간 ",-1),Ve=t("span",{class:"text-sm font-medium"}," 월간 ",-1),Ye={class:"flex items-center space-x-2"},Fe={class:"text-xl font-semibold"},je={class:"flex space-x-2 text-sm font-semibold"},Ie=t("span",null,"Today",-1),Ae=[Ie],Ee=ue('<div class="grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden text-sm"><div class="bg-white py-2 text-center text-sm font-medium">Mon</div><div class="bg-white py-2 text-center text-sm font-medium">Tue</div><div class="bg-white py-2 text-center text-sm font-medium">Wed</div><div class="bg-white py-2 text-center text-sm font-medium">Thu</div><div class="bg-white py-2 text-center text-sm font-medium">Fri</div><div class="bg-white py-2 text-center text-sm font-medium">Sat</div><div class="bg-white py-2 text-center text-sm font-medium">Sun</div></div>',1),Ne={class:"grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-y-auto max-h-[calc(100vh-200px)] text-sm"},ze=["onClick","onDrop"],Te=["onDragstart","onClick"],Be=["onClick"],Oe={class:"inline-block"},Le={class:"ml-auto inline-block"},Ze=["onClick"],Je=t("span",{class:"inline-block"},"상담사",-1),Ue={class:"ml-auto inline-block"},We=["onClick"],qe=t("span",{class:"inline-block"},"상담시간",-1),He={class:"ml-auto inline-block"},Pe=["onClick"],Xe=["onClick"],Ge=["onClick"],Qe=["onClick"],Re={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ke={class:"bg-white p-6 rounded-lg w-96"},et=t("h3",{class:"text-lg font-semibold mb-4"},"일정 이동",-1),tt={class:"mb-4"},st={class:"mb-4"},lt={class:"flex items-center"},ot={class:"flex justify-end space-x-2"},ut={__name:"MonthlyView",setup(H){const D=we(),P=ke(),h=ae({}),C=u(!1),M=u(!1),j=u(""),I=u(""),x=u(""),A=u(!1),S=u(null),$=u(!1),E=u(""),V=u(!1),k=(e,s,n)=>{n.stopPropagation(),h[e]||(h[e]={}),h[e][s]=!h[e][s],Object.keys(h).forEach(o=>{Object.keys(h[o]).forEach(l=>{o!==e&&l!==s&&(h[o][l]=!1)})});const a=n.target.closest(".relative");if(a){const o=a.parentElement.children;for(let l of o)l!==a&&(l.style.display=h[e][s]?"none":"")}},Y=()=>{C.value=!C.value,C.value||(j.value="",I.value="",x.value=""),v(r.value.currentYear,r.value.currentMonth)},B=()=>{M.value=!M.value,M.value||(x.value=""),v(r.value.currentYear,r.value.currentMonth)},X=e=>{x.value=e,B()},G=e=>{x.value=e,Y()},O=(e,s,n)=>{j.value=String(e),I.value=String(s),x.value=n,Y()},Q=async e=>{if(confirm("해당 일정을 삭제하시겠습니까?")&&e)try{await _e(e),v(r.value.currentYear,r.value.currentMonth)}catch(s){console.error("Error deleting schedule:",s)}},N=["January","February","March","April","May","June","July","August","September","October","November","December"],z=u([]),r=u({}),F=u(""),R=e=>{const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${a}`};F.value=R(new Date),console.log("today:",F.value);const K=(e,s)=>{const n=new Date(e,s,1),a=n.getFullYear(),o=n.getMonth()+1;let l=a,c=o-1;c===0&&(c=12,l-=1);let _=a,w=o+1;return w===13&&(w=1,_+=1),console.log("currentYear:",a,"currentMonth:",o),{currentDate:n,currentYear:a,currentMonth:o,currentMonthName:N[o-1],prevYear:l,prevMonth:c,prevMonthName:N[c-1],nextYear:_,nextMonth:w,nextMonthName:N[w-1]}},v=async(e,s)=>{e||(e=new Date().getFullYear()),s||(s=new Date().getMonth()+1);try{const n=await me(e,s);Object.keys(n.data).forEach(a=>{n.data[a].sort((o,l)=>{const c=new Date(`2000-01-01 ${o.schedule_time}`),_=new Date(`2000-01-01 ${l.schedule_time}`);return c-_})}),z.value=n.data,L(e,s-1),console.log("schedule_data:",z.value)}catch(n){console.error("Error fetching monthly schedule data:",n)}},L=(e,s)=>{r.value=K(e,s)};ne(()=>{const e=new Date().getFullYear(),s=new Date().getMonth();L(e,s),v(r.value.currentYear,r.value.currentMonth)}),Z(()=>D.selectedDate,e=>{e&&v(e.getFullYear(),e.getMonth()+1)}),Z(()=>P.selectedTeachers,e=>{e&&v(D.selectedDate.getFullYear(),D.selectedDate.getMonth()+1)});const ee=(e,s)=>{A.value=!0,S.value=e,s.dataTransfer.effectAllowed="move",s.target.style.zIndex="9999"},te=e=>{A.value=!1,e.target.style.zIndex=""},se=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},le=(e,s)=>{s.preventDefault(),S.value&&(E.value=e,$.value=!0)},oe=async()=>{try{(await fe({scheduleId:S.value.schedule_id,scheduleListId:S.value.id,newDate:E.value,updateAllFuture:V.value})).success&&(await v(r.value.currentYear,r.value.currentMonth),$.value=!1,V.value=!1)}catch(e){console.error("Error updating schedule:",e)}};return(e,s)=>{const n=re("router-link");return p(),b(T,null,[De,t("div",Ce,[t("div",Me,[t("div",Se,[m(n,{to:"/admin/weekly",class:f(["inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm text-gray-700 hover:text-gray-900",{"bg-blue-500 text-white":e.$route.path==="/admin/weekly"}])},{default:J(()=>[$e]),_:1},8,["class"]),m(n,{to:"/admin/monthly",class:f(["inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm text-gray-700 hover:text-gray-900",{"bg-blue-500 text-white":e.$route.path==="/admin/monthly"||e.$route.path==="/admin"}])},{default:J(()=>[Ve]),_:1},8,["class"])]),t("div",Ye,[t("button",{class:"p-2 rounded-full font-semibold",onClick:s[0]||(s[0]=a=>v(r.value.prevYear,r.value.prevMonth))},[m(y(ge),{class:"w-6 h-6"})]),t("h2",Fe,d(r.value.currentMonthName)+" "+d(r.value.currentYear),1),t("button",{class:"p-2 rounded-full font-semibold",onClick:s[1]||(s[1]=a=>v(r.value.nextYear,r.value.nextMonth))},[m(y(pe),{class:"w-6 h-6"})])]),t("div",je,[t("button",{class:"px-4 py-2 bg-white border border-gray-300 rounded-md flex items-center",onClick:s[2]||(s[2]=a=>v())},Ae),t("button",{class:"px-4 py-2 bg-blue-500 text-white rounded-md",onClick:Y}," 상담 등록 ")])]),Ee,t("div",Ne,[(p(!0),b(T,null,U(z.value,(a,o)=>(p(),b("div",{class:f(["h-32 p-2",o===F.value?"bg-yellow-100":"bg-white",A.value?"border-2 border-dashed border-blue-500":""]),key:o,onClick:l=>G(o),onDragover:se,onDrop:l=>le(o,l)},[t("span",{class:f({"block text-sm bg-sky-500 text-white ring rounded-full font-semibold w-5 text-center":o===F.value})},d(o.split("-")[2]),3),(p(!0),b(T,null,U(a.slice(0,2),(l,c)=>{var _,w;return p(),b("div",{class:f(["relative flex-row text-xs text-black border border-blue-700/40 rounded-md m-1 space-y-1",["transform transition duration-500 ease-in-out overflow-hidden cursor-move",(_=h[o])!=null&&_[c]?"scale-105 h-auto min-h-6 w-full pt-1":"scale-100 h-6"]]),key:c,draggable:"true",onDragstart:i=>ee(l,i),onDragend:s[3]||(s[3]=i=>te(i)),style:de({backgroundColor:(w=h[o])!=null&&w[c]?"rgba(255, 255, 255, 1)":l.teacher_usercolor}),onClick:g(i=>k(o,c,i),["stop"])},[t("div",{class:f(["flex justify-between items-center px-1 h-full w-full",{"line-through":l.schedule_status==="3"}]),onClick:g(i=>k(o,c,i),["stop"])},[t("span",Oe,d(l.schedule_time),1),t("span",Le,"["+d(l.client_name)+"] "+d(l.program_name.length>10?l.program_name.slice(0,10)+"...":l.program_name),1)],10,Be),t("div",{class:f(["flex justify-between items-center px-1 h-full w-full",{"line-through":l.schedule_status==="3"}]),onClick:g(i=>k(o,c,i),["stop"])},[Je,t("span",Ue,d(l.teacher_fullname),1)],10,Ze),t("div",{class:f(["flex justify-between items-center px-1 h-full w-full",{"line-through":l.schedule_status==="3"}]),onClick:g(i=>k(o,c,i),["stop"])},[qe,t("span",He,d(l.schedule_time)+" ~ "+d(l.schedule_finish_time),1)],10,We),t("div",{class:"flex justify-center items-center px-1 h-full w-full",onClick:g(i=>k(o,c,i),["stop"])},[t("button",{class:"text-xs text-blue-600 border border-blue-700/10 rounded-md m-1 p-0.5 bg-blue-400/20",onClick:g(i=>O(l.schedule_id,l.id,l.schedule_date),["stop"])},[m(y(be),{class:"w-4 h-4"})],8,Xe),t("button",{class:"text-xs text-blue-600 border border-blue-700/10 rounded-md m-1 p-0.5 bg-blue-400/20",onClick:g(i=>Q(l.id),["stop"])},[m(y(ye),{class:"w-4 h-4"})],8,Ge)],8,Pe)],46,Te)}),128)),a.length>2?(p(),b("div",{key:0,class:"mt-4 flex items-center justify-center text-xs text-blue-600 border border-blue-700/10 rounded-md m-1 p-0.5 bg-blue-400/20",onClick:g(l=>X(o),["stop"])},[m(y(xe),{class:"w-4 h-4"}),W(" "+d(a.length-2)+" more ",1)],8,Qe)):q("",!0)],42,ze))),128))]),m(he,{isVisible:C.value,scheduleId:j.value,scheduleListId:I.value,scheduleDate:x.value,onClose:Y,class:"z-20"},null,8,["isVisible","scheduleId","scheduleListId","scheduleDate"]),m(ve,{isDailyViewSlidingVisible:M.value,scheduleDate:x.value,onClose:B,onClickCalendarSchedule:O,class:"z-10"},null,8,["isDailyViewSlidingVisible","scheduleDate"]),$.value?(p(),b("div",Re,[t("div",Ke,[et,t("p",tt,d(E.value)+"로 일정을 이동하시겠습니까? ",1),t("div",st,[t("label",lt,[ce(t("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=a=>V.value=a),class:"mr-2"},null,512),[[ie,V.value]]),W(" 이후 모든 일정에 적용 ")])]),t("div",ot,[t("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:s[5]||(s[5]=a=>$.value=!1)}," 취소 "),t("button",{class:"px-4 py-2 bg-blue-500 text-white rounded",onClick:oe}," 확인 ")])])])):q("",!0)])],64)}}};export{ut as default};
