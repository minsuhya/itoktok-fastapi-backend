import{u as A,i as L,y as _,c as D,a as i,O as K,z as O,U as G,o as h,d as x,e,N,t as g,q as l,x as U,g as o,D as d,F as S,A as T,E as c,G as H,j as $,V as Q,f as z,v as W,W as X,H as P,X as Z}from"./index-Cmu6_IW5.js";import{r as J,u as R,a as Y,b as q,c as ee}from"./client-CwkPjKvS.js";import{_ as te}from"./PaginationView-DXoanFr_.js";import{r as se}from"./CheckIcon-CoMpvM0d.js";const ae={className:"w-full bg-neutral-50 shadow-lg rounded-lg p-6"},le={className:"border-b pb-2 mb-4"},oe={class:"flex items-center justify-evenly mb-2"},ne={class:"font-title font-bold"},re=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1),de=[re],ie=e("label",{class:"block mb-1 text-gray-700"},[$("상담사 "),e("span",{class:"text-red-500"},"*")],-1),ce=e("option",{value:""},"상담사를 선택하세요.",-1),ue=["value"],me={class:"grid grid-cols-2 gap-4"},be=e("label",{class:"block mb-1 text-gray-700"},[$("내담자 이름 "),e("span",{class:"text-red-500"},"*")],-1),pe=e("label",{class:"block mb-1 text-gray-700"},[$("내담자 휴대전화번호 "),e("span",{class:"text-red-500"},"*")],-1),_e=e("label",{class:"block mb-1 text-gray-700"},"관련 태그 입력",-1),ge=e("label",{class:"block mb-1 text-gray-700"},"메모(주소소 문제)",-1),he=e("div",{class:"text-right text-gray-500 text-sm"},"0 / 100",-1),xe={class:"grid grid-cols-2 gap-4"},ve=e("label",{class:"block mb-1 text-gray-700"},"생년월일",-1),ye=e("label",{class:"block mb-1 text-gray-700"},"성별",-1),fe=e("option",{value:""},"성별을 선택하세요.",-1),we=e("option",{value:"M"},"남성",-1),ke=e("option",{value:"F"},"여성",-1),Ve=e("label",{class:"block mb-1 text-gray-700"},"이메일 주소",-1),$e=e("label",{class:"block mb-1 text-gray-700"},"주소",-1),Ce={class:"grid grid-cols-2 gap-4"},Ie=e("label",{class:"block mb-1 text-gray-700"},[$("상담 신청 경로 "),e("span",{class:"text-red-500"},"*")],-1),Ue=e("option",{value:""},"상담 신청 경로를 선택하세요.",-1),Se=e("option",{value:"1"},"가족/지인추천",-1),Me=e("option",{value:"2"},"병원/상담센터를 통해",-1),je=e("option",{value:"3"},"PC/모바일광고",-1),Fe=e("option",{value:"4"},"카페/커뮤니티",-1),Ee=e("button",{type:"submit",class:"bg-green-600 text-white rounded-md p-2 w-[80px]"}," 확인 ",-1),Be={__name:"ClientFormSliding",props:{isVisible:Boolean,clientId:String},emits:["close"],setup(v,{emit:C}){const m=A(),b=v,w=L("showModal"),y=C,f=_([]),V=D({consultant:i().required("상담사를 선택하세요."),client_name:i().required("내담자 이름을 입력하세요."),phone_number:i().required("내담자 휴대전화번호를 입력하세요."),tags:i(),memo:i().max(100,"최대 100자까지 입력할 수 있습니다."),birth_date:i(),gendar:i(),email_address:i().email("올바른 이메일 주소를 입력하세요."),address_region:i(),address_city:i(),family_members:i(),consultation_path:i().required("상담 신청 경로를 선택하세요."),center_username:i()}),s=K({id:"",consultant:"",consultant_status:"1",client_name:"",phone_number:"",tags:"",memo:"",birth_date:"",gender:"",email_address:"",address_region:"",address_city:"",family_members:"",consultation_path:"",center_username:m.user.center_username}),p=()=>{y("close")},k=async()=>{if(!b.clientId){Object.keys(s).forEach(n=>{s[n]=""});return}console.log("props.clientId: ",b.clientId);try{const n=await J(b.clientId);console.log("clientInfo:",n),Object.assign(s,n)}catch(n){console.error("Error fetching client:",n)}},M=async()=>{try{const n=await Q();console.log("teacherList:",n),f.value=n.map(a=>({value:a.username,text:a.full_name}))}catch(n){console.error("Error fetching client:",n)}};O(()=>{k(),M(),console.log("userStore.user.center_username: ",m.user.center_username)});const j=async n=>{console.log("submitting:",n),Object.assign(s,n),s.consultant_status||(s.consultant_status="1"),s.id?(await R(s.id,s),w("내담자 정보가 수정되었습니다.")):(await Y(s),w("내담자 정보가 등록되었습니다.")),y("close")};return G(()=>b.clientId,(n,a)=>{n!==a&&n&&k()}),(n,a)=>(h(),x(S,null,[e("div",{onClick:p,class:N(["fixed inset-0 bg-black bg-opacity-50 transition-opacity duration-1000",{"opacity-100 block":v.isVisible,"opacity-0 hidden":!v.isVisible}])},null,2),e("div",{class:N(["fixed top-0 right-0 w-1/3 h-full bg-white shadow-lg p-4 overflow-auto z-50 transition-transform duration-1000 ease-in-out",{"translate-x-full":!v.isVisible,"translate-x-0":v.isVisible}])},[e("div",ae,[e("div",le,[e("div",oe,[e("h2",ne,"내담자 등록 "+g(v.clientId),1),e("button",{class:"ml-auto",onClick:p},de)]),l(o(H),{onSubmit:j,"validation-schema":o(V),"initial-values":s,class:"space-y-4 text-sm"},{default:U(()=>[l(o(d),{name:"id",as:"input",type:"hidden",modelValue:s.id,"onUpdate:modelValue":a[0]||(a[0]=t=>s.id=t)},null,8,["modelValue"]),l(o(d),{name:"family_members",as:"input",type:"hidden"}),l(o(d),{name:"center_username",as:"input",type:"hidden"}),e("div",null,[ie,l(o(d),{name:"consultant",modelValue:s.consultant,"onUpdate:modelValue":a[1]||(a[1]=t=>s.consultant=t),as:"select",class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2"},{default:U(()=>[ce,(h(!0),x(S,null,T(f.value,t=>(h(),x("option",{key:t.value,value:t.value},g(t.text),9,ue))),128))]),_:1},8,["modelValue"]),l(o(c),{name:"consultant_options",class:"text-red-500 text-xs italic mt-2"})]),e("div",me,[e("div",null,[be,l(o(d),{name:"client_name",as:"input",type:"text",modelValue:s.client_name,"onUpdate:modelValue":a[2]||(a[2]=t=>s.client_name=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2",placeholder:"내담자 이름을 입력하세요."},null,8,["modelValue"]),l(o(c),{name:"client_name",class:"text-red-500 text-xs italic mt-2"})]),e("div",null,[pe,l(o(d),{name:"phone_number",as:"input",type:"text",modelValue:s.phone_number,"onUpdate:modelValue":a[3]||(a[3]=t=>s.phone_number=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2",placeholder:"내담자 휴대전화번호를 입력하세요."},null,8,["modelValue"]),l(o(c),{name:"phone_number",class:"text-red-500 text-xs italic mt-2"})])]),e("div",null,[_e,l(o(d),{name:"tags",as:"input",type:"text",modelValue:s.tags,"onUpdate:modelValue":a[4]||(a[4]=t=>s.tags=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2"},null,8,["modelValue"]),l(o(c),{name:"tags",class:"text-red-500 text-xs italic mt-2"})]),e("div",null,[ge,l(o(d),{name:"memo",as:"textarea",class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2",rows:"3",modelValue:s.memo,"onUpdate:modelValue":a[5]||(a[5]=t=>s.memo=t),placeholder:"내담자의 주소 문제를 메모해보세요. 최대 100자 까지 입력하실 수 있습니다."},null,8,["modelValue"]),l(o(c),{name:"memo",class:"text-red-500 text-xs italic mt-2"}),he]),e("div",xe,[e("div",null,[ve,l(o(d),{name:"birth_date",as:"input",type:"date",modelValue:s.birth_date,"onUpdate:modelValue":a[6]||(a[6]=t=>s.birth_date=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2",placeholder:"2000.01.01"},null,8,["modelValue"]),l(o(c),{name:"birth_date",class:"text-red-500 text-xs italic mt-2"})]),e("div",null,[ye,l(o(d),{modelValue:s.gender,"onUpdate:modelValue":a[7]||(a[7]=t=>s.gender=t),name:"gender",as:"select",class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2"},{default:U(()=>[fe,we,ke]),_:1},8,["modelValue"]),l(o(c),{name:"gender",class:"text-red-500 text-xs italic mt-2"})])]),e("div",null,[Ve,l(o(d),{name:"email_address",as:"input",type:"email",modelValue:s.email_address,"onUpdate:modelValue":a[8]||(a[8]=t=>s.email_address=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2"},null,8,["modelValue"]),l(o(c),{name:"email_address",class:"text-red-500 text-xs italic mt-2"})]),e("div",null,[$e,e("div",Ce,[l(o(d),{name:"address_region",as:"input",modelValue:s.address_region,"onUpdate:modelValue":a[9]||(a[9]=t=>s.address_region=t),class:"bg-neutral-50 border border-gray-300 rounded-md p-2"},null,8,["modelValue"]),l(o(d),{name:"address_city",as:"input",modelValue:s.address_city,"onUpdate:modelValue":a[10]||(a[10]=t=>s.address_city=t),class:"bg-neutral-50 border border-gray-300 rounded-md p-2"},null,8,["modelValue"])]),l(o(c),{name:"address_region",class:"text-red-500 text-xs italic mt-2"}),l(o(c),{name:"address_city",class:"text-red-500 text-xs italic mt-2"})]),e("div",null,[Ie,l(o(d),{name:"consultation_path",as:"select",modelValue:s.consultation_path,"onUpdate:modelValue":a[11]||(a[11]=t=>s.consultation_path=t),class:"w-full bg-neutral-50 border border-gray-300 rounded-md p-2"},{default:U(()=>[Ue,Se,Me,je,Fe]),_:1},8,["modelValue"]),l(o(c),{name:"consultation_path",class:"text-red-500 text-xs italic mt-2"})]),e("div",{class:"flex justify-between mt-4"},[e("button",{type:"button",onClick:p,class:"bg-gray-400 text-white rounded-md p-2 w-[80px]"}," 취소 "),Ee])]),_:1},8,["validation-schema","initial-values"])])])],2)],64))}},Ne=e("section",null,[e("div",{class:"w-full sm:container"},[e("div",{class:"border-black border-l-[5px] pl-5"},[e("h2",{class:"text-dark mb-2 text-2xl font-semibold dark:text-white"},"내담자 관리")])])],-1),ze={class:"lg:flex lg:items-center lg:justify-between mb-2"},Pe={class:"min-w-0 flex-1"},qe={class:"relative"},Le=e("div",{class:"absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none"},[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1),Oe={class:"mt-5 flex lg:ml-4 lg:mt-0"},Te={class:"sm:ml-3"},Ae={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},De={class:"w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},Ke=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3"},"내담자명"),e("th",{scope:"col",class:"px-6 py-3"},"내담자 휴대전화"),e("th",{scope:"col",class:"px-6 py-3"},"내담자 이메일"),e("th",{scope:"col",class:"px-6 py-3"},"센터명"),e("th",{scope:"col",class:"px-6 py-3"},"상담사"),e("th",{scope:"col",class:"px-6 py-3"},"상담상태"),e("th",{scope:"col",class:"px-6 py-3"},"Action")])],-1),Ge={scope:"row",class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"},He={class:"px-6 py-4"},Qe={class:"px-6 py-4"},We={class:"px-6 py-4"},Xe={class:"px-6 py-4"},Ze={key:0,class:"flex items-center"},Je={key:1,class:"flex items-center"},Re=["onClick"],Ye={class:"px-6 py-4"},et=["onUpdate:modelValue","onChange"],tt=e("option",{value:"1"},"상담진행",-1),st=e("option",{value:"2"},"상담보류",-1),at=e("option",{value:"3"},"상담종결",-1),lt=[tt,st,at],ot={class:"px-6 py-4"},nt={class:"flex items-center space-x-2"},rt=["onClick"],mt={__name:"ClientList",setup(v){const C=L("showModal"),m=_(1),b=_(10),w=_(0),y=_(!1),f=_(""),V=_(""),s=_([]),p=()=>{y.value=!y.value,y.value||(f.value="",k(m.value))},k=async t=>{const u=await q(t);s.value=u.items,m.value=u.page,b.value=u.size,w.value=u.total,console.log("clients:",s.value)},M=async()=>{try{const t=await q(1,10,V.value);s.value=t.items,m.value=t.page,b.value=t.size,w.value=t.total}catch(t){console.error("Error fetching clients:",t)}},j=t=>{k(t),m.value=t},n=async t=>{console.log("client:",t);try{await ee(t.id,t.consultant_status),C("상담상태 정보가 수정되었습니다.")}catch(u){C("상담상태 정보 등록 중 오류가 발생했습니다."),console.error("Error registering client data:",u)}},a=(t="")=>{t?f.value=String(t):f.value="",p()};return O(k),(t,u)=>(h(),x(S,null,[Ne,e("div",ze,[e("div",Pe,[e("div",qe,[Le,z(e("input",{type:"text",id:"table-search-users",name:"search-text","onUpdate:modelValue":u[0]||(u[0]=r=>V.value=r),class:"block pt-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg w-80 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"내담자 검색",onKeyup:X(M,["enter"])},null,544),[[W,V.value]])])]),e("div",Oe,[e("span",Te,[e("button",{type:"button",onClick:p,class:"inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},[l(o(se),{class:"-ml-0.5 mr-1.5 h-5 w-5","aria-hidden":"true"}),$(" 내담자 등록 ")])])])]),e("div",Ae,[e("table",De,[Ke,e("tbody",null,[(h(!0),x(S,null,T(s.value,r=>{var F,E,B;return h(),x("tr",{key:r.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("th",Ge,g(r.client_name),1),e("td",He,g(r.phone_number),1),e("td",Qe,g(r.email_address),1),e("td",We,g((E=(F=r.consultant_info)==null?void 0:F.center_info)==null?void 0:E.center_name),1),e("td",Xe,[r.consultant?(h(),x("div",Ze,g((B=r.consultant_info)==null?void 0:B.full_name)+"("+g(r.consultant)+") ",1)):P("",!0),r.consultant?P("",!0):(h(),x("div",Je,[e("button",{class:"text-blue-600 dark:text-blue-500 hover:underline font-semibold border py-1 px-3 rounded-lg bg-blue-100 dark:bg-blue-800 dark:border-blue-600 dark:hover:bg-blue-700 dark:hover:border-blue-700 dark:text-white dark:hover:text-white dark:hover:bg-blue-700 dark:hover:border-blue-700",onClick:I=>p(r.id)}," 상담자배정 ",8,Re)]))]),e("td",Ye,[z(e("select",{class:"w-24 h-9 bg-gray-100 border border-gray-300 rounded-md px-2 text-sm","onUpdate:modelValue":I=>r.consultant_status=I,onChange:I=>n(r)},lt,40,et),[[Z,r.consultant_status]])]),e("td",ot,[e("div",nt,[e("a",{href:"#",onClick:I=>a(r.id),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"내담자정보",8,rt)])])])}),128))])]),l(te,{"total-items":w.value,"current-page":m.value,"items-per-page":b.value,onPageChanged:j},null,8,["total-items","current-page","items-per-page"]),l(Be,{isVisible:y.value,clientId:f.value,onClose:p},null,8,["isVisible","clientId"])])],64))}};export{mt as default};
